# -
# æŠ˜è…¾äº†å‡ å¤©ç ”ç©¶äº†ä¸€ä¸‹æ ¡å›­ç½‘ è§‰å¾—æœ‰ç”¨çš„è€é“ç‚¹ç‚¹èµåŠ©ï¼
<img src="å¾®ä¿¡å›¾ç‰‡_20240925221923.jpg" alt="å¾®ä¿¡å›¾ç‰‡_20240925221923" style="zoom:33%;" />
# åå†œæ ¡å›­ç½‘æŠ˜è…¾æŒ‡å—ï¼ˆå ç½‘é€Ÿ&å¤šè®¾å¤‡ï¼‰

## å…ˆä¸Šå•ç½‘å£ç½‘é€Ÿå›¾

## ![image-20240924220922903](image-20240924220922903.png)

<img src="image-20240924220714886.png" alt="image-20240924220714886" style="zoom:33%;" />

ä¸ºä»€ä¹ˆæ²¡æœ‰å åŠ ç½‘é€Ÿå›¾å‘¢ï¼Ÿå› ä¸ºæ¥¼ä¸»è·¯ç”±å™¨å¤ªåƒåœ¾æ— çº¿æ¡¥æ¥æ—¶æ— è®ºå¦‚ä½•wanå£ä¼šæ‰çº¿ä½†æ˜¯ç†è®ºä¸Šæ˜¯å¯ä»¥å åŠ çš„ï¼å¸Œæœ›æœ‰äººæˆåŠŸå¯ä»¥è¿”å›¾ã€‚

**é¦–å…ˆå‡†å¤‡å¯ä»¥åˆ·openwrtçš„è·¯ç”±å™¨å¹¶åœ¨ç¼–è¯‘å›ºä»¶æ—¶åŠ å…¥**

```
mentohust luci ua2f luci-app-ua2f iptables-mod-filter iptables-mod-ipopt iptables-mod-u32 iptables-mod-conntrack-extra kmod-ipt-u32 kmod-ipt-ipopt luci-app-mwan3
```

## å…ˆè¯´å ç½‘é€Ÿ

### ç½‘å£è®¾ç½®

å…ˆç½‘çº¿æ¥ä¸Šè·¯ç”±å™¨wanå£

è¿›å…¥openwrtåè¿›å…¥mentohust

![image-20240925213906376](image-20240925213906376.png)

Usernameï¼ˆè´¦å·ï¼‰å¤„å¡«å†™å­¦å·@æœ‰çº¿1xä¸Šç½‘

Passwordå¡«æ ¡å›­ç½‘å¯†ç ï¼ˆé»˜è®¤æ˜¯å­¦å·ï¼‰

æ³¨æ„Interfacesï¼ˆæ¥å£ï¼‰å¡«wanå£çš„ç‰©ç†æ¥å£

é«˜çº§è®¾ç½®é»˜è®¤å°±å¥½ï¼Œç„¶åå¼€å§‹è®¤è¯

### WiFiè®¾ç½®

æ³¨æ„å¤§éƒ¨åˆ†openwrté»˜è®¤çš„è½¯ä»¶åŒ…ä¸­ä½¿ç”¨çš„éƒ½æ˜¯wpadçš„ç²¾ç®€ç‰ˆæ²¡æœ‰wpa2-eapåè®®æ‰€ä»¥åœ¨ç¼–è¯‘æ—¶éœ€è¦æ›´æ”¹ä¸ºï¼ˆwpadï¼‰

![image-20240925214304164](image-20240925214304164.png)

ä½ ğŸ‰çš„wifiæœ‰ä¸¤ç§è®¤è¯æ–¹å¼ï¼Œæ²¡æœ‰1xåç¼€çš„ä¸ºç½‘é¡µè®¤è¯ï¼Œæœ‰1xåç¼€çš„æ˜¯å¯ä»¥é¢„å…ˆè®¤è¯çš„ï¼ˆwpa2-eapï¼‰

ç‚¹å‡»radio1(5g)çš„scan(æ‰«æ)è¿æ¥SCAUNET_1x

![image-20240925215714630](image-20240925215714630.png)

åˆ†é…networkä¸ºwwan

![image-20240925214849742](image-20240925214849742.png)æ›´æ”¹Encryptionä¸ºwpa2-eap

![image-20240925214954739](image-20240925214954739.png)

è¿æ¥åæ”¾ä¸€è¾¹å¤‡ç”¨

### è´Ÿè½½å‡è¡¡

![image-20240925215410519](image-20240925215410519.png)

![image-20240925215424917](image-20240925215424917.png)

![image-20240925215431636](image-20240925215431636.png)

![image-20240925215437296](image-20240925215437296.png)

çœ‹å›¾

åŒçº¿å åŠ 



## å†è¯´ç ´è§£è¿æ¥è®¾å¤‡é™åˆ¶

å…ˆäººçš„æ™ºæ…§[EOYOHOO/Campus-network: ä½¿ç”¨openwrtè·¯ç”±è¿‡æ ¡å›­ç½‘å¤šè®¾å¤‡æ£€æµ‹ï¼ˆéç ´è§£ï¼‰ ï¼ˆå®¿èˆå…±ç½‘ï¼‰ (github.com)](https://github.com/EOYOHOO/Campus-network?tab=readme-ov-file)

å·²çŸ¥â€ğŸ‰ä½¿ç”¨çš„ä¸æ˜¯åŸºäº IPv4 æ•°æ®åŒ…åŒ…å¤´å†…çš„ Identification å­—æ®µçš„æ£€æµ‹ æ‰€ä»¥ä¸ç”¨è£…kmod-rkp-ipidï¼Œè¿™æ®µè§„åˆ™

```
iptables -t nat -A PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 53

iptables -t nat -A PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 53

# é€šè¿‡ rkp-ipid è®¾ç½® IPID

# è‹¥æ²¡æœ‰åŠ å…¥rkp-ipidæ¨¡å—ï¼Œæ­¤éƒ¨åˆ†ä¸éœ€è¦åŠ å…¥

iptables -t mangle -N IPID_MOD

iptables -t mangle -A FORWARD -j IPID_MOD

iptables -t mangle -A OUTPUT -j IPID_MOD

iptables -t mangle -A IPID_MOD -d 0.0.0.0/8 -j RETURN

iptables -t mangle -A IPID_MOD -d 127.0.0.0/8 -j RETURN

#ç”±äºæœ¬æ ¡å±€åŸŸç½‘æ˜¯Aç±»ç½‘ï¼Œæ‰€ä»¥æˆ‘å°†è¿™ä¸€æ¡æ³¨é‡Šæ‰äº†ï¼Œå…·ä½“è¦ä¸è¦æ³¨é‡Šç»“åˆä½ æ‰€åœ¨çš„æ ¡å›­ç½‘

# iptables -t mangle -A IPID_MOD -d 10.0.0.0/8 -j RETURN

iptables -t mangle -A IPID_MOD -d 172.16.0.0/12 -j RETURN

iptables -t mangle -A IPID_MOD -d 192.168.0.0/16 -j RETURN

iptables -t mangle -A IPID_MOD -d 255.0.0.0/8 -j RETURN

iptables -t mangle -A IPID_MOD -j MARK --set-xmark 0x10/0x10

# é˜²æ—¶é’Ÿåç§»æ£€æµ‹

iptables -t nat -N ntp_force_local

iptables -t nat -I PREROUTING -p udp --dport 123 -j ntp_force_local

iptables -t nat -A ntp_force_local -d 0.0.0.0/8 -j RETURN

iptables -t nat -A ntp_force_local -d 127.0.0.0/8 -j RETURN

iptables -t nat -A ntp_force_local -d 192.168.0.0/16 -j RETURN

iptables -t nat -A ntp_force_local -s 192.168.0.0/16 -j DNAT --to-destination 192.168.1.1

# é€šè¿‡ iptables ä¿®æ”¹ TTL å€¼ æ•°å­—ä¸ºéœ€è¦çš„ä¿®æ”¹çš„ttlå€¼

iptables -t mangle -A POSTROUTING -j TTL --ttl-set 64

# iptables æ‹’ç» AC è¿›è¡Œ Flash æ£€æµ‹

iptables -I FORWARD -p tcp --sport 80 --tcp-flags ACK ACK -m string --algo bm --string " src=\"http://1.1.1." -j DROP
```

ä¸­çš„

```
# è‹¥æ²¡æœ‰åŠ å…¥rkp-ipidæ¨¡å—ï¼Œæ­¤éƒ¨åˆ†ä¸éœ€è¦åŠ å…¥

iptables -t mangle -N IPID_MOD

iptables -t mangle -A FORWARD -j IPID_MOD

iptables -t mangle -A OUTPUT -j IPID_MOD

iptables -t mangle -A IPID_MOD -d 0.0.0.0/8 -j RETURN

iptables -t mangle -A IPID_MOD -d 127.0.0.0/8 -j RETURN
```

ä¸ç”¨åŠ å…¥ï¼

è‡³æ­¤å®Œå…¨ä½“

# æ”¯æŒä¸»æ’­åå¯ä»¥è”ç³»æˆ‘çº¿ä¸‹æŒ‡å¯¼
## ![å¾®ä¿¡å›¾ç‰‡_20240925221923](å¾®ä¿¡å›¾ç‰‡_20240925221923.jpg)
